
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Usage &#8212; PySpark Vector Files alpha documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/basic_mod.css?v=0.7.0-1" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <script src="_static/js/petite-vue.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Reference" href="api.html" />
    <link rel="prev" title="PySpark Vector Files" href="index.html" /> 
  </head><body>

<div id="top_nav">
    

    <nav>
        <p id="toggle_sidebar">
            <a href="#" title="Toggle sidebar">|||</a>
        </p>
        <h1><a href="index.html" title="Go to homepage">PySpark Vector Files alpha documentation</a></h1>

        <a id="mode_toggle" href="#" @click.prevent="handleClick" :title="mode">
    <template v-if="mode == 'light'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_light"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M67.48,18.073c1.913,-1.912 1.913,-5.018 0,-6.931c-1.912,-1.912 -5.018,-1.912 -6.931,0l-6.798,6.799c-1.912,1.912 -1.912,5.018 0,6.931c1.913,1.912 5.018,1.912 6.931,-0l6.798,-6.799Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.728,61.108c1.912,-1.913 1.912,-5.018 -0,-6.931c-1.913,-1.913 -5.019,-1.913 -6.931,-0l-6.799,6.798c-1.912,1.913 -1.912,5.019 0,6.931c1.913,1.913 5.019,1.913 6.931,0l6.799,-6.798Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.682,54.177c-1.913,-1.913 -5.018,-1.913 -6.931,-0c-1.912,1.913 -1.912,5.018 0,6.931l6.798,6.798c1.913,1.913 5.019,1.913 6.931,0c1.913,-1.912 1.913,-5.018 0,-6.931l-6.798,-6.798Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M4.901,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,-0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M18.929,11.142c-1.912,-1.912 -5.018,-1.912 -6.931,0c-1.912,1.913 -1.912,5.019 0,6.931l6.799,6.799c1.912,1.912 5.018,1.912 6.931,-0c1.912,-1.913 1.912,-5.019 -0,-6.931l-6.799,-6.799Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.108,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c-0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c-0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'dark'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_dark"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.901,2.196 -4.901,4.901c0,2.705 2.197,4.901 4.901,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.662,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.989,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.732,61.103c1.91,-1.91 1.91,-5.011 0,-6.921l-0.009,-0.01c-1.91,-1.91 -5.012,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.909,1.91 5.011,1.91 6.92,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.672,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.52,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l-0,-0.01c-0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.901,2.196 -4.901,4.901c0,2.704 2.197,4.9 4.901,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.73,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 -0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.098,34.623c-2.699,0 -4.891,2.192 -4.891,4.892l-0,0.019c-0,2.699 2.192,4.891 4.891,4.891c2.7,0 4.892,-2.192 4.892,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.892,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'darkest'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_darkest"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><path d="M39.315,23.791c8.684,-0 15.734,7.05 15.734,15.733c0,8.684 -7.05,15.734 -15.734,15.734c-8.683,0 -15.733,-7.05 -15.733,-15.734c-0,-8.683 7.05,-15.733 15.733,-15.733Zm0,4.737c6.069,0 10.997,4.927 10.997,10.996c-0,6.069 -4.928,10.996 -10.997,10.996c-6.068,0 -10.996,-4.927 -10.996,-10.996c0,-6.069 4.928,-10.996 10.996,-10.996Z" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.216,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.9,2.196 -4.9,4.901c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.666,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.99,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.737,61.103c1.909,-1.91 1.909,-5.011 -0,-6.921l-0.01,-0.01c-1.91,-1.91 -5.011,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.91,1.91 5.011,1.91 6.921,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.676,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.524,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l0,-0.01c0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.216,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901c-0,2.704 2.196,4.9 4.9,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.734,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.103,34.623c-2.7,0 -4.892,2.192 -4.892,4.892l-0,0.019c-0,2.699 2.192,4.891 4.892,4.891c2.699,0 4.891,-2.192 4.891,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.891,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>
</a>

<script>
(function() {
    const LOCAL_STORAGE_KEY = 'piccoloThemeMode'

    var initialMode = localStorage.getItem(LOCAL_STORAGE_KEY)

    if (initialMode) {
        // Make sure the value in local storage is valid
        if (['light', 'dark', 'darkest'].indexOf(initialMode) == -1) {
            initialMode = 'light'
            localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
        }
    } else {
        // Check if the client prefers dark mode
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            initialMode = 'dark'
        } else {
            initialMode = 'light'
        }
        localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
    }

    document.documentElement.dataset.mode = initialMode

    PetiteVue.createApp({
        'mode': initialMode,
        handleClick() {
            let currentMode = this.mode

            if (currentMode == 'light') {
                this.mode = 'dark'
            } else if (currentMode == 'dark') {
                this.mode = 'darkest'
            } else if (currentMode == 'darkest') {
                this.mode = 'light'
            }

            document.documentElement.dataset.mode = this.mode
            localStorage.setItem(LOCAL_STORAGE_KEY, this.mode)

            console.log(this.mode)
        }
    }).mount('#mode_toggle')
})()
</script>
            <p class="mobile_search_link">
                <a href="search.html" title="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 65 64" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2">
                        <path d="M14.873 40.009c-2.315-3.943-3.642-8.532-3.642-13.429C11.231 11.91 23.141 0 37.811 0s26.58 11.91 26.58 26.58-11.91 26.58-26.58 26.58a26.44 26.44 0 0 1-14.277-4.161L9.739 62.794a3.12 3.12 0 0 1-4.413 0L.913 58.382c-1.217-1.218-1.217-3.196 0-4.413l13.96-13.96zM37.811 8.054c10.225 0 18.526 8.301 18.526 18.526s-8.301 18.526-18.526 18.526-18.526-8.301-18.526-18.526S27.586 8.054 37.811 8.054z" fill="#fff" />
                    </svg>
                </a>
            </p>
        

        <div class="searchbox_wrapper">
            
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
    </nav>
</div>

    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>

        </div>
      </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h1>
<p>Read various spatial vector formats into a Spark DataFrame.</p>
<section id="basic-usage">
<h2>Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this heading">¶</a></h2>
<p>Read the first layer from a file or files into a single Spark DataFrame:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sdf</span> <span class="o">=</span> <span class="n">read_vector_files</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/files/&quot;</span><span class="p">,</span>
    <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.ext&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="filename-pattern-matching">
<h2>Filename pattern matching<a class="headerlink" href="#filename-pattern-matching" title="Permalink to this heading">¶</a></h2>
<p>Read files that begin with “abc” into a single Spark DataFrame:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sdf</span> <span class="o">=</span> <span class="n">read_vector_files</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/files/&quot;</span><span class="p">,</span>
    <span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;abc*&quot;</span><span class="p">,</span>
    <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.ext&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Read files that end with four digits into a single Spark DataFrame:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sdf</span> <span class="o">=</span> <span class="n">read_vector_files</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/files/&quot;</span><span class="p">,</span>
    <span class="n">pattern</span><span class="o">=</span><span class="s2">&quot;*[0-9][0-9][0-9][0-9]&quot;</span><span class="p">,</span>
    <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.ext&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>For more information on pattern matching using Unix shell-style wildcards, see
Python’s <a class="reference external" href="https://docs.python.org/3/library/fnmatch.html#module-fnmatch">fnmatch</a> module.</p>
</section>
<section id="reading-files-from-nested-folders">
<h2>Reading files from nested folders<a class="headerlink" href="#reading-files-from-nested-folders" title="Permalink to this heading">¶</a></h2>
<p>By default, the library will only look within the specified folder. To enable
recursive searching of subdirectories, use the <cite>recursive</cite> argument.</p>
<p>Given the following folder structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">files</span>
<span class="o">|</span>    <span class="n">file_0</span><span class="o">.</span><span class="n">ext</span>
<span class="o">|</span>    <span class="n">file_1</span><span class="o">.</span><span class="n">ext</span>
<span class="o">|</span>
<span class="o">|--</span> <span class="n">subfolder</span>
<span class="o">|</span>        <span class="n">file_2</span><span class="o">.</span><span class="n">ext</span>
<span class="o">|</span>        <span class="n">file_3</span><span class="o">.</span><span class="n">ext</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sdf</span> <span class="o">=</span> <span class="n">read_vector_files</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/files/&quot;</span><span class="p">,</span>
    <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.ext&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>will read <cite>file_0.ext</cite> and <cite>file_1.ext</cite>, while</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sdf</span> <span class="o">=</span> <span class="n">read_vector_files</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/files/&quot;</span><span class="p">,</span>
    <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.ext&quot;</span><span class="p">,</span>
    <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>will read <cite>file_0.ext</cite>, <cite>file_1.ext</cite>, <cite>subfolder/file_2.ext</cite>, and
<cite>subfolder/file_3.ext</cite>.</p>
</section>
<section id="reading-layers">
<h2>Reading layers<a class="headerlink" href="#reading-layers" title="Permalink to this heading">¶</a></h2>
<p>Read a specific layer for a file or files, using layer name:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sdf</span> <span class="o">=</span> <span class="n">read_vector_files</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/files/&quot;</span><span class="p">,</span>
    <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.ext&quot;</span><span class="p">,</span>
    <span class="n">layer_identifier</span><span class="o">=</span><span class="s2">&quot;layer_name&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>or layer index:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sdf</span> <span class="o">=</span> <span class="n">read_vector_files</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/files/&quot;</span><span class="p">,</span>
    <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.ext&quot;</span><span class="p">,</span>
    <span class="n">layer_identifier</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="gdal-virtual-file-systems">
<h2>GDAL Virtual File Systems<a class="headerlink" href="#gdal-virtual-file-systems" title="Permalink to this heading">¶</a></h2>
<p>Read compressed files using GDAL Virtual File Systems:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sdf</span> <span class="o">=</span> <span class="n">read_vector_files</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/files/&quot;</span><span class="p">,</span>
    <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.gz&quot;</span><span class="p">,</span>
    <span class="n">layer_identifier</span><span class="o">=</span><span class="s2">&quot;layer_name&quot;</span><span class="p">,</span>
    <span class="n">vsi_prefix</span><span class="o">=</span><span class="s2">&quot;/vsigzip/&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>For more information, see <a class="reference external" href="https://gdal.org/user/virtual_file_systems.html">GDAL Virtual File Systems</a>.</p>
</section>
<section id="user-defined-schema">
<h2>User-defined Schema<a class="headerlink" href="#user-defined-schema" title="Permalink to this heading">¶</a></h2>
<p>By default, a schema will be generated from the first file in the folder. For a
single tabular dataset that has been partitioned across several files, this will
work fine.</p>
<p>However, it won’t work for a list format like GML, as not every file will contain
the same fields. In this case, you can define a schema yourself. You will also need
to set the coerce_to_schema flag to True.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">LongType</span><span class="p">()),</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">()),</span>
        <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="n">BinaryType</span><span class="p">()),</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">sdf</span> <span class="o">=</span> <span class="n">read_vector_files</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/files/&quot;</span><span class="p">,</span>
    <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.ext&quot;</span><span class="p">,</span>
    <span class="n">layer_identifier</span><span class="o">=</span><span class="s2">&quot;layer_name&quot;</span><span class="p">,</span>
    <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
    <span class="n">coerce_to_schema</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="concurrency-strategy">
<h2>Concurrency Strategy<a class="headerlink" href="#concurrency-strategy" title="Permalink to this heading">¶</a></h2>
<p>By default, the function will parallelise across files.</p>
<p>This should work well for single dataset that has been partitioned across several
files. Especially if it has been partition so that those individual files can be
comfortably read into memory on a single machine.</p>
<p>However, the function also provides a way of parallelising across chunks of rows
within a file or files.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sdf</span> <span class="o">=</span> <span class="n">read_vector_files</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/files/&quot;</span><span class="p">,</span>
    <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.ext&quot;</span><span class="p">,</span>
    <span class="n">concurrency_strategy</span><span class="o">=</span><span class="s2">&quot;rows&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>By default, a chunk will consist of 1 million rows but you can change this using the
<cite>ideal_chunk_size</cite> parameter.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sdf</span> <span class="o">=</span> <span class="n">read_vector_files</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/files/&quot;</span><span class="p">,</span>
    <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.ext&quot;</span><span class="p">,</span>
    <span class="n">concurrency_strategy</span><span class="o">=</span><span class="s2">&quot;rows&quot;</span><span class="p">,</span>
    <span class="n">ideal_chunk_size</span><span class="o">=</span><span class="mi">5_000_000</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Reading chunks adds a substantial overhead as files have to be opened to get a row
count. The “rows” strategy should only be used for a single large file or a small
number of large files.</p>
</div>
</section>
<p>Functions for reading a GeoPackage using Spark’s JDBC drivers.</p>
<section id="reading-a-geopackage-using-spark-s-jdbc-drivers">
<h2>Reading a GeoPackage using Spark’s JDBC drivers.<a class="headerlink" href="#reading-a-geopackage-using-spark-s-jdbc-drivers" title="Permalink to this heading">¶</a></h2>
<section id="register-the-geopackage-dialect">
<h3>Register the GeoPackage Dialect<a class="headerlink" href="#register-the-geopackage-dialect" title="Permalink to this heading">¶</a></h3>
<p>To read a GeoPackage using Spark’s JDBC drivers, you will need to register a custom
mapping of GeoPackage to Spark Catalyst types.</p>
<p>To do this, run the following in a Databricks notebook cell:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">scala</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">apache</span><span class="p">.</span><span class="nn">spark</span><span class="p">.</span><span class="nn">sql</span><span class="p">.</span><span class="nn">jdbc</span><span class="p">.{</span><span class="nc">JdbcDialect</span><span class="p">,</span><span class="w"> </span><span class="nc">JdbcDialects</span><span class="p">}</span>
<span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">apache</span><span class="p">.</span><span class="nn">spark</span><span class="p">.</span><span class="nn">sql</span><span class="p">.</span><span class="nn">types</span><span class="p">.</span><span class="n">_</span>

<span class="k">object</span><span class="w"> </span><span class="nc">GeoPackageDialect</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nc">JdbcDialect</span><span class="w"> </span><span class="p">{</span>
<span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">canHandle</span><span class="p">(</span><span class="n">url</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">):</span><span class="w"> </span><span class="nc">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">url</span><span class="p">.</span><span class="n">startsWith</span><span class="p">(</span><span class="s">&quot;jdbc:sqlite&quot;</span><span class="p">)</span>

<span class="k">override</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">getCatalystType</span><span class="p">(</span>
<span class="w">    </span><span class="n">sqlType</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">,</span>
<span class="w">    </span><span class="n">typeName</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span>
<span class="w">    </span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">,</span>
<span class="w">    </span><span class="n">md</span><span class="p">:</span><span class="w"> </span><span class="nc">MetadataBuilder</span>
<span class="p">):</span><span class="w"> </span><span class="nc">Option</span><span class="p">[</span><span class="nc">DataType</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">typeName</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;BOOLEAN&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Some</span><span class="p">(</span><span class="nc">BooleanType</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;TINYINT&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Some</span><span class="p">(</span><span class="nc">ByteType</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;SMALLINT&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Some</span><span class="p">(</span><span class="nc">ShortType</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;MEDIUMINT&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Some</span><span class="p">(</span><span class="nc">IntegerType</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;INT&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;INTEGER&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Some</span><span class="p">(</span><span class="nc">LongType</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;FLOAT&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Some</span><span class="p">(</span><span class="nc">FloatType</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;DOUBLE&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;REAL&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Some</span><span class="p">(</span><span class="nc">DoubleType</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;TEXT&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Some</span><span class="p">(</span><span class="nc">StringType</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;BLOB&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Some</span><span class="p">(</span><span class="nc">BinaryType</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;GEOMETRY&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;POINT&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;LINESTRING&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;POLYGON&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;MULTIPOINT&quot;</span><span class="w"> </span><span class="o">|</span>
<span class="w">    </span><span class="s">&quot;MULTILINESTRING&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;MULTIPOLYGON&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;GEOMETRYCOLLECTION&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;CIRCULARSTRING&quot;</span><span class="w"> </span><span class="o">|</span>
<span class="w">    </span><span class="s">&quot;COMPOUNDCURVE&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;CURVEPOLYGON&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;MULTICURVE&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;MULTISURFACE&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;CURVE&quot;</span><span class="w"> </span><span class="o">|</span>
<span class="w">    </span><span class="s">&quot;SURFACE&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Some</span><span class="p">(</span><span class="nc">BinaryType</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;DATE&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Some</span><span class="p">(</span><span class="nc">DateType</span><span class="p">)</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;DATETIME&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Some</span><span class="p">(</span><span class="nc">StringType</span><span class="p">)</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="nc">JdbcDialects</span><span class="p">.</span><span class="n">registerDialect</span><span class="p">(</span><span class="nc">GeoPackageDialect</span><span class="p">)</span>
</pre></div>
</div>
<p>Once you’ve registered the GeoPackage dialect, you can list the layers in a given
GeoPackage, get the coordinate reference system of a given layer, or read a layer
into a Spark DataFrame with the geometry column encoded as Well Known Binary.</p>
</section>
<section id="list-layers">
<h3>List layers<a class="headerlink" href="#list-layers" title="Permalink to this heading">¶</a></h3>
<p>To list the layers in a given GeoPackage, use <a class="reference internal" href="api.html#pyspark_vector_files.gpkg.list_layers" title="pyspark_vector_files.gpkg.list_layers"><code class="xref py py-func docutils literal notranslate"><span class="pre">list_layers()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">list_layers</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/file.gpkg&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="get-the-coordinate-reference-system-of-a-layer">
<h3>Get the coordinate reference system of a layer<a class="headerlink" href="#get-the-coordinate-reference-system-of-a-layer" title="Permalink to this heading">¶</a></h3>
<p>To get the coordinate reference system of a layers in a given GeoPackage, use
<a class="reference internal" href="api.html#pyspark_vector_files.gpkg.get_crs" title="pyspark_vector_files.gpkg.get_crs"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_crs()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">get_crs</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/file.gpkg&quot;</span>
    <span class="n">layer_name</span><span class="o">=</span><span class="s2">&quot;layer_name&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="get-the-bounding-box-of-a-layer">
<h3>Get the bounding box of a layer<a class="headerlink" href="#get-the-bounding-box-of-a-layer" title="Permalink to this heading">¶</a></h3>
<p>To get the bounding box of a layers in a given GeoPackage, use
<code class="xref py py-func docutils literal notranslate"><span class="pre">get_bounds()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">get_bounds</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/file.gpkg&quot;</span>
    <span class="n">layer_name</span><span class="o">=</span><span class="s2">&quot;layer_name&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="read-a-layer-into-a-spark-dataframe">
<h3>Read a layer into a Spark DataFrame<a class="headerlink" href="#read-a-layer-into-a-spark-dataframe" title="Permalink to this heading">¶</a></h3>
<p>To read a layer into a Spark DataFrame, use <a class="reference internal" href="api.html#pyspark_vector_files.gpkg.read_gpkg" title="pyspark_vector_files.gpkg.read_gpkg"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_gpkg()</span></code></a>, If you don’t supply
a layer, the first layer will be read:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">read_gpkg</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/file.gpkg&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<section id="read-a-specific-layer">
<h4>Read a specific layer<a class="headerlink" href="#read-a-specific-layer" title="Permalink to this heading">¶</a></h4>
<p>If you supply a layer, that will be read:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">read_gpkg</span><span class="p">(</span>
     <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/file.gpkg&quot;</span>
     <span class="n">layer_name</span><span class="o">=</span><span class="s2">&quot;layer_name&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="supply-a-custom-geometry-column-name">
<h4>Supply a custom geometry column name<a class="headerlink" href="#supply-a-custom-geometry-column-name" title="Permalink to this heading">¶</a></h4>
<p>The function will assume that the geometry column is called <cite>geom</cite>, if it’s called
something else, supply a different <cite>original_geometry_column_name</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">read_gpkg</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/file.gpkg&quot;</span>
    <span class="n">layer_name</span><span class="o">=</span><span class="s2">&quot;layer_name&quot;</span>
    <span class="n">original_geometry_column_name</span><span class="o">=</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="geopackage-geometry-encoding">
<h4>GeoPackage Geometry Encoding<a class="headerlink" href="#geopackage-geometry-encoding" title="Permalink to this heading">¶</a></h4>
<p><a class="reference external" href="https://www.geopackage.org/spec/#gpb_format">GeoPackage Geometry Encoding</a> consists of two parts:</p>
<ol class="arabic simple">
<li><p>A GeoPackage Binary (GPB) header</p></li>
<li><p>A <a class="reference external" href="https://libgeos.org/specifications/wkb/">Well Known Binary (WKB)</a> geometry</p></li>
</ol>
<p>By default, the function will split the original geometry column into these two
parts, unpack the GPB header, and return both as, respectively, <cite>gpb_header</cite> and
<cite>wkb_geometry</cite>.</p>
<p>If you don’t want the GPB header, set <cite>drop_gpb_header</cite> to <cite>True</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">read_gpkg</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/file.gpkg&quot;</span>
    <span class="n">layer_name</span><span class="o">=</span><span class="s2">&quot;layer_name&quot;</span>
    <span class="n">drop_gpb_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The length of the GPB header depends on the format of envelope (bounding box) included
in it. The function assumes that the envelope will be [minx, maxx, miny, maxy] and
that, therefore, the GPB header will be 40 bytes long. However, it’s possible for the
format of the envelope to be [minx, maxx, miny, maxy, minz, maxz] or [minx, maxx, miny,
maxy, minm, maxm] and, therefore 56 bytes long, or [minx, maxx, miny, maxy, minz, maxz,
minm, maxm] and, therefore, 72 bytes long.</p>
<p>In these cases you will need to set <cite>header_length</cite> to the appropriate value:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">read_gpkg</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/file.gpkg&quot;</span>
    <span class="n">layer_name</span><span class="o">=</span><span class="s2">&quot;layer_name&quot;</span>
    <span class="n">header_length</span><span class="o">=</span><span class="mi">56</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
    
        <div id="show_right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon"><</span><span>Page contents<span></a></p>
        </div>

        <div id="right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon">></span><span>Page contents:<span></a></p>
            <div class="page_toc">
                <ul>
<li><a class="reference internal" href="#">Usage</a><ul>
<li><a class="reference internal" href="#basic-usage">Basic usage</a></li>
<li><a class="reference internal" href="#filename-pattern-matching">Filename pattern matching</a></li>
<li><a class="reference internal" href="#reading-files-from-nested-folders">Reading files from nested folders</a></li>
<li><a class="reference internal" href="#reading-layers">Reading layers</a></li>
<li><a class="reference internal" href="#gdal-virtual-file-systems">GDAL Virtual File Systems</a></li>
<li><a class="reference internal" href="#user-defined-schema">User-defined Schema</a></li>
<li><a class="reference internal" href="#concurrency-strategy">Concurrency Strategy</a></li>
<li><a class="reference internal" href="#reading-a-geopackage-using-spark-s-jdbc-drivers">Reading a GeoPackage using Spark’s JDBC drivers.</a><ul>
<li><a class="reference internal" href="#register-the-geopackage-dialect">Register the GeoPackage Dialect</a></li>
<li><a class="reference internal" href="#list-layers">List layers</a></li>
<li><a class="reference internal" href="#get-the-coordinate-reference-system-of-a-layer">Get the coordinate reference system of a layer</a></li>
<li><a class="reference internal" href="#get-the-bounding-box-of-a-layer">Get the bounding box of a layer</a></li>
<li><a class="reference internal" href="#read-a-layer-into-a-spark-dataframe">Read a layer into a Spark DataFrame</a><ul>
<li><a class="reference internal" href="#read-a-specific-layer">Read a specific layer</a></li>
<li><a class="reference internal" href="#supply-a-custom-geometry-column-name">Supply a custom geometry column name</a></li>
<li><a class="reference internal" href="#geopackage-geometry-encoding">GeoPackage Geometry Encoding</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            </div>
        </div>
    

      <div class="clearer"></div>
    </div>
    <div class="button_nav_wrapper">
        <div class="button_nav">
            <div class="left">
                
                <a href="index.html">
                    <span class="icon"><</span><span>PySpark Vector Files</span></a>
                
            </div>

            <div class="right">
                
                    <a href="api.html"><span>API Reference</span><span class="icon">></span></a>
                
            </div>
        </div>
    </div>


    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Ed Fawcett-Taylor, Dan Lewis.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>

<p id="theme_credit">Styled using the <a href="https://github.com/piccolo-orm/piccolo_theme">Piccolo Theme</a></p>
  </body>
</html>